CODE FOR INVERT
      SUBROUTINE INVERT
      CALL XSYSDC(-1,1)
      CALL XSFLSD
      RETURN
      END
C
CODE FOR XSFLSD
      SUBROUTINE XSFLSD
C--MAIN CONTROL ROUTINE FOR INVERTING THE NORMAL MATRIX
C  AND SOLVING THE LEAST SQUARES EQUATIONS.
C
C--
\ISTORE
\ICOM24
C
\STORE
\XUNITS
\XLST12
\XLST24
\XLST50
C
\QSTORE
\QLST24
C
C--LOAD THE NEXT '#INSTRUCTION'
1000  CONTINUE
      NUM=KNXTOP(LSTOP,LSTNO,ICLASS)
C--CHECK IF WE SHOULD RETURN
      IF(NUM)1100,1100,1200
1100  CONTINUE
      RETURN
C--BRANCH ON THE TYPE OF OPERATION
1200  CONTINUE
      GOTO (2000,6000,7000,8000,8500,8600,1300),NUM
C1300  STOP 57
1300  CALL GUEXIT(57)
C
C--'#INVERT'  -  INVERT THE NORMAL MATRIX
2000  CONTINUE
      CALL XSFLSE
      GOTO 1000
C
C--'#SOLVE'  -  SOLVE THE NORMAL EQUATIONS
6000  CONTINUE
      CALL XSFLSG
      GOTO 1000
C
C--'#NEWSHIFTS'  -  PREPARE LIST 24 WHEN IT IS OUT OF STEP
7000  CONTINUE
      I=KRDDPV(ISTORE(NFL),1)
\IDIM24
C--LOAD LIST 12 TO FIND THE NUMBER OF LEAST SQUARES PARAMETERS
      CALL XFAL12(0,0,I,J)
      IF ( IERFLG .LT. 0 ) GO TO 1000
C--SET THE ORDER OF THE SHIFT LIST
      N24=N12
C--CREATE LIST 24
      CALL XCELST(24,ICOM24,IDIM24)
C--WRITE THE LIST TO THE DISC
      CALL XWLSTD(24,ICOM24,IDIM24,0,0)
      CALL XRSL
      CALL XCSAE
      GOTO 1000
C
C--'#CYCLENDS' INSTRUCTION
8000  CONTINUE
      I=KRDDPV(ISTORE(NFL),1)
      CALL XCYCLE
      GOTO 1000
C
C--'#END' INSTRUCTION
8500  CONTINUE
      CALL XMONTR(-1)
      CALL XEND
      GOTO 1000
C
C--'#TITLE' INSTRUCTION
8600  CONTINUE
      CALL XRCN
      GOTO 1000
      END
C
