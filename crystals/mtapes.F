C $Log: mtapes.F,v $
C Revision 1.3  2005/01/23 08:29:11  rich
C Reinstated CVS change history for all FPP files.
C History for very recent (January) changes may be lost.
C
C Revision 1.1.1.1  2004/12/13 11:16:08  rich
C New CRYSTALS repository
C
C Revision 1.2  2001/02/26 10:29:08  richard
C Added changelog to top of file
C
C
CODE FOR XIMTW
      SUBROUTINE XIMTW(IN)
C--INITIATE MAGNETIC TAPE WRITE
C
C  IN  LENGTH OF EACH INDIVIDUAL ITEM
C
C--
C
      CALL XIMTT(IN,1)
      RETURN
      END
C
CODE FOR XIMTR
      SUBROUTINE XIMTR(IN)
C--INITIATE MAGNETIC TAPE READ
C
C  IN  LENGTH OF EACH ITEM
C
C--
      INCLUDE 'XTAPED.INC'
C
C--CALL THE INITIALISING ROUTINE
      CALL XIMTT(IN,2)
C--SET THE BUFFER POINTER SO THAT NO DATA IS IN THE BUFFER
      MMTR=NMTR
      RETURN
      END
C
CODE FOR XIMTT
      SUBROUTINE XIMTT(IN,IM)
C--INITIATE MAGNETIC TAPE TRANSFER
C
C  IN  LENGTH OF EACH INDIVIDUAL ITEM
C  IM  1 FOR WRITE AND 2 FOR READ
C
C--
      INCLUDE 'STORE.INC'
      INCLUDE 'XLISTI.INC'
C
      COMMON /XTAPED/L(4,2)
C
C
      DATA NWMTBF/254/
C
C--ASSIGN THE ITEM LENGTH
      LENGTH=IN
C--CHECK IF THE ITEM LENGTH IS ZERO
      IF(LENGTH)1000,1000,1050
C--ITEM LENGTH IS ZERO  -  TRANSFER IS ONE BUFFER AT A TIME
1000  CONTINUE
      LENGTH=NWMTBF
C--SET THE LAST WORD IN THE BUFFER
1050  CONTINUE
      L(4,IM)=LFL
C--SET THE LIST AND RECORD TYPES
      LN=200
      IREC=100+IM
      L(1,IM)=KCHLFL(NWMTBF/LENGTH*LENGTH)
C--SET THE CURRENT ADDRESS TO THE START OF THE BUFFER
      L(2,IM)=L(1,IM)
C--SET THE INCREMENT FOR EACH ITEM
      L(3,IM)=LENGTH
      RETURN
      END
C
CODE FOR XIMTWA
      SUBROUTINE XIMTWA(N)
C--INCREMENT THE MAGNETIC TAPE WRITE ADDRESS FOR UNIT 'N'
C
C  N  THE UNIT NUMBER ON WHICH THE TRANSFER IS TO BE MADE.
C
C--
      INCLUDE 'STORE.INC'
      INCLUDE 'XTAPED.INC'
C
C--INCREMENT THE CURRENT BUFFER POSITION
      MMTW=MMTW+MDMTW
C--CHECK FOR A FULL BUFFER
      IF(MMTW-NMTW)1050,1050,1000
C--BUFFER IS FULL  -  OUTPUT IT AND RESET THE POINTERS
1000  CONTINUE
      WRITE(N)(STORE(M),M=LMTW,NMTW)
      MMTW=LMTW
1050  CONTINUE
      RETURN
      END
C
CODE FOR XIMTRA
      SUBROUTINE XIMTRA(N)
C--INCREMENT THE MAGNETIC TAPE READ ADDRESS FOR UNIT 'N'
C
C  N  THE UNIT NUMBER ON WHICH TO DO THE TRANSFER
C
C--
      INCLUDE 'STORE.INC'
      INCLUDE 'XTAPED.INC'
C
C--INCREMENT THE BUFFER ADDRESS
      MMTR=MMTR+MDMTR
C--CHECK IF THE BUFFER IS FULL
      IF(MMTR-NMTR)1050,1050,1000
C--BUFFER IS FULL  -  READ ANOTHER AND RESET THE POINTERS
1000  CONTINUE
      READ(N)(STORE(M),M=LMTR,NMTR)
      MMTR=LMTR
1050  CONTINUE
      RETURN
      END
C
CODE FOR XTMTW
      SUBROUTINE XTMTW(N)
C--TERMINATE THE MAGNETIC TAPE WRITE FOR UNIT 'N'
C
C  N  THE UNIT NUMBER BEING USED FOR OUTPUT.
C
C--
      INCLUDE 'STORE.INC'
      INCLUDE 'XTAPED.INC'
C
C--WRITE THE LAST BUFFER OUT
      WRITE(N)(STORE(M),M=LMTW,NMTW)
      MMTW=LMTW
      ENDFILEN
      REWINDN
      RETURN
      END
C
CODE FOR XTMTR
      SUBROUTINE XTMTR(N)
C--TERMINATE THE TRANFERS ON THE INPUT M/T 'N'
C
C  N  THE NUMBER OF THE M/T BEING USED FOR INPUT
C
C--
      INCLUDE 'XTAPED.INC'
C
      REWINDN
      MMTR=NMTR
      RETURN
      END
C
C

